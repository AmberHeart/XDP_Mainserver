# 测试环境脚本

此目录包含可用于创建测试的安装脚本 用于测试 XDP 程序的环境。它通过创建虚拟来工作 以太网 （VETH） 接口对并将每对的一端移动到另一端 网络命名空间。您可以在其他命名空间中加载 XDP 程序，并且 通过根中可见的接口向其发送流量 命名空间。

不带参数运行以获取可用命令的列表，或者 运行以获取包含所有选项的完整帮助列表。这 脚本可以同时保持多个环境处于活动状态，而您 可以使用该选项在它们之间切换。`./testenv.sh``./testenv.sh --help``--name`

如果未指定名称，则最近使用的环境将是 使用。如果在设置新环境时未指定名称，则 将为您生成随机名称。

例子：

设置名为“test”的新环境：`./testenv.sh setup --name=test`

创建 shell 别名，以便从任何地方轻松使用脚本：`eval $(./testenv.sh alias)`

查看当前活动环境以及所有活动环境的列表 名称（别名定义如上）：`t status`

输入当前活动环境：`t enter`

在环境中执行命令：`t exec -- ip a`

拆除环境：`t teardown`

# 了解网络拓扑

设置测试环境时，两者之间将有一个虚拟链接 新命名空间内的环境，以及从 主机系统根命名空间。新命名空间将以 传递给脚本的环境名称，接口在 外部命名空间。命名空间**内的**接口将始终命名 “veth0”。

为了说明这一点，创建一个名为“test01”的测试环境（将导致设置以下环境 sp|`t setup --name test01`

```
+-----------------------------+                          +-----------------------------+
| Root namespace              |                          | Testenv namespace 'test01'  |
|                             |      From 'test01'       |                             |
|                    +--------+ TX->                RX-> +--------+                    |
|                    | test01 +--------------------------+  veth0 |                    |
|                    +--------+ <-RX                <-TX +--------+                    |
|                             |       From 'veth0'       |                             |
+-----------------------------+                          +-----------------------------+
```

根命名空间中可见的“test01”接口就是我们将要成为的接口 在教程课程中安装 XDP 程序。XDP 程序将看到 在此接口上**接收**的数据包;从图中可以看出， 这意味着所有数据包都是从新命名空间内部传输的。

以这种方式创建设置以模拟主机的情况 具有物理接口;但不是来自外部的交通 物理接口上的主机，它们将从命名空间内部到达 虚拟接口。这也意味着当您生成流量时 测试您的 XDP 程序，您需要从测试**内部**生成它 环境。该命令将在测试中启动 ping 环境默认，您可以在 环境通过使用 ，或者简单地使用 生成一个 shell。`t ping``t exec -- <command>``t enter`
